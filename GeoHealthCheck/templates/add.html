{% extends "layout.html" %}
{% block body %}
<div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-3 main">
  <form role="form" action="" method="post">
    <h2>{{ _('Add Resource') }} <i class="fa fa-plus fa-fw"></i></h2>
    <div class="form-group input-group col-sm-3">
        <select id="resource_type" class="form-control" name="resource_type">
            <option value="none">{{ _('Select Resource Type') }}</option>
            {% for key, value in resource_types.items() %}
              {% if 'resource_type' in request.args and request.args['resource_type'] == key %}
                {% set selected = 'selected' %}
              {% else %}
                {% set selected = '' %}
              {% endif %}
            <option value="{{ key }}" {{ selected }}>{{ value['label'] }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group input-group col-sm-5">
        <h4>NOTE: Only HTTP urls are allowd. No HTTPS (SSL) urls permitted.</h4>
        <input type="text" name="url" pattern="^http:\/\/.+$" class="form-control" autofocus required>
        <p class="help-block">
            Enter the URL WITH query parameters:
            <br/>good:
                <code>http://host/wms?service=WMS&version=1.1.1&request=GetCapabilities</code>
            <br/>bad: 
            <code>http://host/wms</code>
            <br/>
        </p>
        <script>
            // Credit: https://stackoverflow.com/questions/19122886/how-can-i-create-a-custom-message-when-an-html5-required-input-pattern-does-not#answer-19123002
            // function attachHandler(el, evtname, fn) {
            //     if (el.addEventListener) {
            //         el.addEventListener(evtname, fn.bind(el), false);
            //     } else if (el.attachEvent) {
            //         el.attachEvent('on' + evtname, fn.bind(el));
            //     }
            // }
            // attachHandler(window, "load", function(){
            //     var ele = document.querySelector("input[name=url]");
            //     attachHandler(ele, "invalid", function () {
            //         this.setCustomValidity("Only HTTP (not HTTPS) urls are allowed.");
            //     });
            // });
        </script>
    </div>
    <div class="form-group input-group col-sm-5">
        <select id="tags" name="tags" class="form-control" multiple="multiple"></select>
    </div>
    <div class="form-group">
        <button type="submit" class="btn btn-success">{{ _('Submit') }}</button>
    </div>
  </form>
</div>
{% endblock %}

{% block extrafoot %}
<script type="text/javascript">
$('#tags').select2({
    data: {{ tags.keys()|tojson }},
    tags: true,
    placeholder: '{{ _('Enter tags') }}'
});

</script>
{% endblock %}
